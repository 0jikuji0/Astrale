<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Astéroïde texturé avec Terre en fond</title>
<style>
  body { margin:0; overflow:hidden; }
  canvas { display:block; }
</style>
</head>
<body>
<canvas id="canvas"></canvas>
<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/simplex-noise@2.4.0/dist/umd/simplex-noise.min.js"></script>
<script>
let scene, camera, renderer, asteroid, earth;
let mouseX = 0, mouseY = 0;
let targetRotX = 0, targetRotY = 0;
let isDragging = false;

// --- Scene & Renderer ---
scene = new THREE.Scene();
scene.background = new THREE.Color(0x000000);

camera = new THREE.PerspectiveCamera(45, window.innerWidth/window.innerHeight, 0.1, 5000);
camera.position.set(0, 5, 10);
camera.lookAt(0,0,0);

renderer = new THREE.WebGLRenderer({canvas: document.getElementById('canvas'), antialias:true});
renderer.setSize(window.innerWidth, window.innerHeight);

// --- Lumières ---
scene.add(new THREE.AmbientLight(0xffffff, 0.4));

const light1 = new THREE.PointLight(0xff7f24, 2, 2000);
light1.position.set(10,10,10);
scene.add(light1);

const light2 = new THREE.PointLight(0x6495ed, 2, 2000);
light2.position.set(-10,-5,-10);
scene.add(light2);

// --- Terre en arrière-plan ---
const earthGeo = new THREE.SphereGeometry(2, 64, 64);
const earthTex = new THREE.TextureLoader().load(
  'https://unpkg.com/three-globe@2.24.4/example/img/earth-blue-marble.jpg'
);
const earthMat = new THREE.MeshPhongMaterial({ map: earthTex, shininess: 10 });
earth = new THREE.Mesh(earthGeo, earthMat);
earth.position.set(0, -2, -10);
scene.add(earth);

// --- Astéroïde au centre ---

const geom = new THREE.SphereGeometry(0.5, 200, 64);
const pos = geom.attributes.position;
const v = new THREE.Vector3();

for (let i = 0; i < pos.count; i++) {
  v.fromBufferAttribute(pos, i);
    
}

pos.needsUpdate = true;
geom.computeVertexNormals(); 
geom.computeBoundingSphere();


// --- Textures ---
const loader = new THREE.TextureLoader();
const colorMap = loader.load('textures/Rock030_1K-JPG_Color.jpg');
const roughnessMap = loader.load('textures/Rock030_1K-JPG_Roughness.jpg');
const normalMap = loader.load('textures/Rock030_1K-JPG_NormalGL.jpg');
const displacementMap = loader.load('textures/Rock030_1K-JPG_Displacement.jpg');
const aoMap = loader.load('textures/Rock030_1K-JPG_AmbientOcclusion.jpg');

// --- Material ---
const meteorMaterial = new THREE.MeshStandardMaterial({
    map: colorMap,
    roughnessMap: roughnessMap,
    roughness: 0.8,
    metalness: 0.1,
    normalMap: normalMap,
    displacementMap: displacementMap,
    displacementScale: 0.3,   
    aoMap: aoMap,
    flatShading: false
});

asteroid = new THREE.Mesh(geom, meteorMaterial);
asteroid.r = {x:0.002, y:0.004, z:0.003};
scene.add(asteroid);

// --- Etoiles ---
const starsGeom = new THREE.BufferGeometry();
const starsMat = new THREE.PointsMaterial({color:0xffffff, size:0.01});
const starsVerts = [];
for(let i=0;i<5000;i++){
  starsVerts.push((Math.random()-0.5)*200, (Math.random()-0.5)*200, (Math.random()-0.5)*200);
}
starsGeom.setAttribute('position', new THREE.Float32BufferAttribute(starsVerts, 3));
scene.add(new THREE.Points(starsGeom, starsMat));

// --- Mouse ---
const canvas = renderer.domElement;
canvas.addEventListener('mousedown', e=>{ isDragging=true; mouseX=e.clientX; mouseY=e.clientY; });
canvas.addEventListener('mousemove', e=>{
  if(isDragging){
    const dx = e.clientX - mouseX;
    const dy = e.clientY - mouseY;
    targetRotY += dx*0.005;
    targetRotX += dy*0.005;
    targetRotX = Math.max(-Math.PI/2, Math.min(Math.PI/2, targetRotX));
    mouseX = e.clientX;
    mouseY = e.clientY;
  }
});
canvas.addEventListener('mouseup', ()=>{ isDragging=false; });
canvas.addEventListener('wheel', e=>{
  e.preventDefault();
  camera.position.z += e.deltaY * 0.01;
  camera.position.z = Math.max(5, Math.min(30, camera.position.z));
});
window.addEventListener('resize', ()=>{
  camera.aspect = window.innerWidth/window.innerHeight;
  camera.updateProjectionMatrix();
  renderer.setSize(window.innerWidth, window.innerHeight);
});

// --- Animation ---
function animate(){
  requestAnimationFrame(animate);

  // Rotation astéroïde
  asteroid.rotation.x += asteroid.r.x;
  asteroid.rotation.y += asteroid.r.y;
  asteroid.rotation.z += asteroid.r.z;

  // Rotation Terre lente
  earth.rotation.y += 0.0005;

  // Caméra autour de l'astéroïde
  const radius = 10;
  camera.position.x = radius * Math.sin(targetRotY) * Math.cos(targetRotX)+5;
  camera.position.y = radius * Math.sin(targetRotX)+1;
  camera.position.z = radius * Math.cos(targetRotY) * Math.cos(targetRotX);
  camera.lookAt(asteroid.position);

  renderer.render(scene, camera);
}

animate();
</script>
</body>
</html>
